package main

import (
	"testing"

	"github.com/dgraph-io/dgraph/protos"
)

func TestDecodeMsg(t *testing.T) {

	//var msg = []byte{
	//0x0a, 0x14, 0x09, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x12, 0x05, 0x50, 0x65, 0x74,
	//0x65, 0x72, 0x20, 0x01, 0x60, 0x03, 0x22, 0x23, 0x00, 0x00, 0x00, 0x01, 0x80, 0xff, 0xff, 0xff,
	//0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	//0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	//}

	//var msg = []byte{
	//0x0a, 0x13, 0x09, 0xb3, 0xd1, 0x24, 0x8b, 0x9a, 0xb2, 0xa6, 0x05, 0x12, 0x04, 0x6e, 0x61, 0x6d,
	//0x65, 0x20, 0x01, 0x60, 0x03, 0x22, 0x22, 0x00, 0x00, 0x00, 0x01, 0x80, 0xb3, 0xa3, 0x93, 0xd9,
	//0xa8, 0xd3, 0xac, 0xd3, 0x05, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	//0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	//}

	//var msg = []byte{
	//0x0a, 0x19, 0x09, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x12, 0x08, 0x11, 0x27, 0x00,
	//0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x02, 0x20, 0x01, 0x60, 0x03, 0x22, 0x23, 0x00, 0x00, 0x00,
	//0x01, 0x80, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x01, 0x00, 0x00, 0x00, 0x00,
	//0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	//}

	//var msg = []byte{
	//0x00, 0x00, 0x00, 0x01, 0x80, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	//0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	//}

	//var msg = []byte{
	//0x0a, 0x0b, 0x09, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x60, 0x03, 0x22, 0x23, 0x00,
	//0x00, 0x00, 0x01, 0x80, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x01, 0x00, 0x00,
	//0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	//0x00, 0x00,
	//}

	//var msg = []byte{
	//0x0a, 0x0b, 0x09, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x60, 0x03, 0x22, 0x1a, 0x00,
	//0x00, 0x00, 0x01, 0x80, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	//0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	//}

	//var msg = []byte{
	//0x0a, 0x19, 0x09, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x12, 0x08, 0x0d, 0x00, 0x00,
	//0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x02, 0x20, 0x01, 0x60, 0x03, 0x22, 0x23, 0x00, 0x00, 0x00,
	//0x01, 0x80, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x01, 0x00, 0x00, 0x00, 0x00,
	//0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	//}

	var msg = []byte{
		0x0a, 0x11, 0x09, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x12, 0x02, 0x31, 0x33, 0x20,
		0x01, 0x60, 0x03, 0x22, 0x23, 0x00, 0x00, 0x00, 0x01, 0x80, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
		0xff, 0xff, 0xff, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	}

	var list protos.PostingList
	if err := list.Unmarshal(msg); err != nil {
		t.Fatal(err)
	}

	t.Logf("#%v", list)
}

func TestDecodeSchemaUpdate(t *testing.T) {
	//var msg = []byte{
	//0x10, 0x02,
	//}

	var msg = []byte{
		0x10, 0x07,
	}

	var out protos.SchemaUpdate
	if err := out.Unmarshal(msg); err != nil {
		t.Fatal(err)
	}

	t.Logf("%#v", out)
}
